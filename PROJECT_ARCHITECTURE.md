# Project Architecture Overview

**–ü—Ä–æ–µ–∫—Ç:** DAOsail Prototype - Next.js App
**–í–µ—Ä—Å–∏—è:** 0.7.2
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-01-24
**–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ - Phase 7.2 Architecture Analysis Complete

---

## üìä Technology Stack

### Frontend
- **Framework:** Next.js 13.5.1 + React 18 + TypeScript
- **State Management:** React Context API (AppContext)
- **UI/CSS:** Tailwind CSS + Radix UI + Lucide React icons
- **Routing:** Next.js App Router (app/ directory)
- **Themes:** next-themes –¥–ª—è dark/light mode

### Backend & Infrastructure
- **Database:** Supabase (PostgreSQL + Real-time + Storage)
- **Authentication:** Supabase Auth —Å Email/Password
- **API:** Supabase REST API + TypeScript SDK
- **Storage:** Supabase Storage –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **Static Data:** Mock –¥–∞–Ω–Ω—ã–µ + —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–µ–π
- **Persistence:** Supabase + localStorage –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- **Real-time:** Supabase Realtime –¥–ª—è live –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- **Future:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å DAO –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏

### Key Dependencies
```json
{
  "next": "15.5.3",
  "react": "18.2.0",
  "typescript": "5.2.2",
  "@radix-ui/*": "—Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ UI primitives",
  "lucide-react": "^0.446.0",
  "tailwindcss": "3.3.3",
  "next-themes": "^0.3.0",
  "@supabase/supabase-js": "^2.x.x",
  "@supabase/ssr": "^0.x.x",
  "openai": "^4.x.x"
}
```

### AI & ML Stack
- **LLM Model:** OpenAI GPT-4o-mini –¥–ª—è —ç–∫–æ–Ω–æ–º–∏—á–Ω—ã—Ö, –Ω–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- **Embeddings:** OpenAI text-embedding-ada-002 –¥–ª—è vector –ø–æ–∏—Å–∫–∞
- **Vector Database:** Supabase pgvector extension
- **Knowledge Base:** –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å –ø–∞—Ä—É—Å–Ω–æ–π —Ç–µ–º–∞—Ç–∏–∫–æ–π

---

## üóÇÔ∏è Project Structure

```
app/
‚îú‚îÄ‚îÄ (auth)/               # Auth layout group
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx        # Layout –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ login/            # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îî‚îÄ‚îÄ signup/           # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ (main)/               # Main layout group
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx        # –û—Å–Ω–æ–≤–Ω–æ–π layout —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx          # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ about/            # –°—Ç—Ä–∞–Ω–∏—Ü—ã –æ –∫–ª—É–±–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx      # –û–±—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ "–û –∫–ª—É–±–µ"
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ concepts/     # –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ chat/             # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —á–∞—Ç–∞ —Å –ò–ò
‚îÇ   ‚îú‚îÄ‚îÄ communities/      # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–Ω–µ—à–Ω–∏—Ö —Å–æ–æ–±—â–µ—Å—Ç–≤
‚îÇ   ‚îú‚îÄ‚îÄ community/        # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
‚îÇ   ‚îú‚îÄ‚îÄ dao/              # –°—Ç—Ä–∞–Ω–∏—Ü–∞ DAO —Ñ—É–Ω–∫—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ library/          # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ profile/          # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è —Å —Ç–∞–±–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ tutorial/         # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–±—É—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ api/                  # API Routes
‚îÇ   ‚îú‚îÄ‚îÄ chat/             # OpenAI —á–∞—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ search-knowledge/ # –ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
‚îú‚îÄ‚îÄ layout.tsx            # Root layout
‚îî‚îÄ‚îÄ globals.css           # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏

components/
‚îú‚îÄ‚îÄ layout/               # Layout –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ left-sidebar.tsx  # –õ–µ–≤–∞—è –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ right-sidebar.tsx # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø—Ä–∞–≤—ã–π —Å–∞–π–¥–±–∞—Ä (–≥–æ—Å—Ç—å/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
‚îÇ   ‚îú‚îÄ‚îÄ top-bar.tsx       # –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ footer.tsx        # –ü–æ–¥–≤–∞–ª
‚îÇ   ‚îî‚îÄ‚îÄ mobile-drawer.tsx # –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
‚îú‚îÄ‚îÄ profile/              # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ—Ñ–∏–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ profile-sidebar.tsx    # –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Å–∞–π–¥–±–∞—Ä
‚îÇ   ‚îú‚îÄ‚îÄ profile-info-tab.tsx   # –í–∫–ª–∞–¥–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è + –∞–≤–∞—Ç–∞—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ my-path-tab.tsx        # –í–∫–ª–∞–¥–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îî‚îÄ‚îÄ achievements-tab.tsx   # –í–∫–ª–∞–¥–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
‚îî‚îÄ‚îÄ ui/                   # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    ‚îú‚îÄ‚îÄ hero-card.tsx     # –ì–ª–∞–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞
    ‚îú‚îÄ‚îÄ chat-box.tsx      # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–∞—Ç–∞
    ‚îú‚îÄ‚îÄ quick-questions.tsx # –ë—ã—Å—Ç—Ä—ã–µ –≤–æ–ø—Ä–æ—Å—ã
    ‚îú‚îÄ‚îÄ avatar-upload.tsx # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–æ–≤
    ‚îú‚îÄ‚îÄ community-card.tsx # –ö–∞—Ä—Ç–æ—á–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–æ–æ–±—â–µ—Å—Ç–≤
    ‚îú‚îÄ‚îÄ concept-card.tsx  # –ö–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–π
    ‚îî‚îÄ‚îÄ ...               # –î—Ä—É–≥–∏–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

lib/
‚îú‚îÄ‚îÄ contexts/
‚îÇ   ‚îî‚îÄ‚îÄ app-context.tsx   # –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase
‚îú‚îÄ‚îÄ supabase/             # Supabase –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ client.ts         # Supabase client
‚îÇ   ‚îú‚îÄ‚îÄ server.ts         # Server-side client
‚îÇ   ‚îú‚îÄ‚îÄ types.ts          # TypeScript —Ç–∏–ø—ã –¥–ª—è –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ profile-service.ts # –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ—Ñ–∏–ª—è–º–∏ + real-time
‚îú‚îÄ‚îÄ services/             # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ achievement-service.ts # –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ chat-service.ts   # –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å OpenAI API
‚îÇ   ‚îî‚îÄ‚îÄ embedding-service.ts # –†–∞–±–æ—Ç–∞ —Å vector embeddings
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îú‚îÄ‚îÄ profile.ts        # –¢–∏–ø—ã –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ assistants.ts     # –¢–∏–ø—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ roles.ts          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–æ–ª–µ–π –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
‚îî‚îÄ‚îÄ utils.ts              # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã

data/
‚îú‚îÄ‚îÄ chat-messages.ts      # Mock –¥–∞–Ω–Ω—ã–µ –¥–ª—è —á–∞—Ç–∞
‚îî‚îÄ‚îÄ mock-profile.ts       # Mock –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

supabase/                 # Supabase CLI –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ migrations/           # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ 001_create_profiles_schema.sql
‚îÇ   ‚îî‚îÄ‚îÄ 002_setup_vector_embeddings.sql
‚îú‚îÄ‚îÄ config.toml          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase CLI
‚îî‚îÄ‚îÄ seed.sql             # –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ + –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π

scripts/                  # –£—Ç–∏–ª–∏—Ç—ã –∏ —Å–∫—Ä–∏–ø—Ç—ã
```

---

## üèóÔ∏è Core Architecture Decisions

### 1. UI Architecture: Radix UI + Tailwind CSS

**–†–µ—à–µ–Ω–∏–µ:** Radix UI primitives + Tailwind CSS –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏  
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (accessibility) –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- ‚úÖ –ì–∏–±–∫–∞—è –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Tailwind
- ‚úÖ –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (composable components)
- ‚úÖ TypeScript –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã:**
- ‚ùå Material UI - —Å–ª–∏—à–∫–æ–º –æ–ø–∏–Ω–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω
- ‚ùå Chakra UI - –º–µ–Ω—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–µ–π

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**
```typescript
// –ü—Ä–∏–º–µ—Ä Radix UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';

export function MyComponent() {
  return (
    <Card className="p-4">
      <CardContent>
        <Button variant="outline">Action</Button>
      </CardContent>
    </Card>
  );
}
```

### 2. State Management: React Context API

**–†–µ—à–µ–Ω–∏–µ:** React Context API –≤–º–µ—Å—Ç–æ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫  
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ React, –Ω–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö/—Å—Ä–µ–¥–Ω–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- ‚úÖ TypeScript –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- ‚úÖ –õ–µ–≥–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 3. Routing: Next.js App Router

**–†–µ—à–µ–Ω–∏–µ:** App Router (app/) –≤–º–µ—Å—Ç–æ Pages Router  
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ Next.js 13+
- ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ layouts –∏ nested routing
- ‚úÖ –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ Server Components –ø–æ–¥–¥–µ—Ä–∂–∫–∞

---

## üîß Key Services & Components

### App Context (lib/contexts/app-context.tsx)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
```typescript
interface AppContextType {
  theme: 'light' | 'dark';
  language: 'en' | 'ru';
  responsesLeft: number;
  isAuthenticated: boolean;
  toggleTheme: () => void;
  toggleLanguage: () => void;
  decrementResponses: () => void;
  resetResponses: () => void;
  setAuthenticated: (value: boolean) => void;
}
```

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ localStorage
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º—ã –∫ document
- –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å ru/en
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞–º–∏ –¥–ª—è –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### UI Components (components/ui/)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞ –±–∞–∑–µ Radix UI  
**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `HeroCard` ‚Üí –≥–ª–∞–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞–º–∏ –∏ –∞–Ω–∏–º–∞—Ü–∏—è–º–∏
- `ChatBox` ‚Üí –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —á–∞—Ç —Å OpenAI API + –ø–æ–∏—Å–∫ + –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
- `QuickQuestions` ‚Üí –±—ã—Å—Ç—Ä—ã–µ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –Ω–∞—á–∞–ª–∞ –¥–∏–∞–ª–æ–≥–∞
- `SoftGateBanner` ‚Üí –±–∞–Ω–Ω–µ—Ä —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –¥–ª—è –≥–æ—Å—Ç–µ–π
- `EmailCapture` ‚Üí —Ñ–æ—Ä–º–∞ —Å–±–æ—Ä–∞ email –¥–ª—è –≥–æ—Å—Ç–µ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞
- `AssistantDock` ‚Üí –ø–ª–∞–≤–∞—é—â–∞—è –ø–∞–Ω–µ–ª—å –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞–º

**–ü–∞—Ç—Ç–µ—Ä–Ω—ã:**
```typescript
// –ü—Ä–∏–º–µ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–µ–π
export function MyComponent() {
  const { language } = useAppContext();
  
  return (
    <div>
      {language === 'ru' ? '–¢–µ–∫—Å—Ç' : 'Text'}
    </div>
  );
}
```

### Layout System (components/layout/)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `LeftSidebar` ‚Üí –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º
- `RightSidebar` ‚Üí –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `TopBar` ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ —Ç–µ–º—ã/—è–∑—ã–∫–∞
- `Footer` ‚Üí –ø–æ–¥–≤–∞–ª —Å–∞–π—Ç–∞
- `MobileDrawer` ‚Üí –º–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è

### ProfileService (lib/supabase/profile-service.ts)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
```typescript
- getFullProfile(userId) ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
- transformToAppProfile() ‚Üí –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏–∑ Supabase –≤ —Ñ–æ—Ä–º–∞—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- updateProfile() / updateStats() ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- incrementStat() ‚Üí –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- uploadAvatar() ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–æ–≤ –≤ Supabase Storage
- checkAndPromoteRole() ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ —Ä–æ–ª–µ–π
- subscribeToProfile() ‚Üí real-time –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
```

### AchievementService (lib/services/achievement-service.ts)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
```typescript
- checkAndAddAchievements() ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- getAllTemplates() ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —à–∞–±–ª–æ–Ω–æ–≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- getProgressForAchievement() ‚Üí —Ä–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- 12 –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö:
  * engagement (–≤–æ–ø—Ä–æ—Å—ã, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)
  * learning (—É—Ä–æ–∫–∏, —Å—Ç–∞—Ç—å–∏)
  * social (—Å–æ–æ–±—â–µ—Å—Ç–≤–æ)
  * progression (–ø–æ–≤—ã—à–µ–Ω–∏–µ —Ä–æ–ª–µ–π)
  * special (–æ—Å–æ–±—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è)
```

### AvatarUpload Component (components/ui/avatar-upload.tsx)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–æ–≤
**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- Drag & Drop –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ (—Ç–∏–ø, —Ä–∞–∑–º–µ—Ä –¥–æ 5MB)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase Storage
- Responsive –¥–∏–∑–∞–π–Ω –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
- –°–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏

### ChatService (lib/services/chat-service.ts)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI API –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏
**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
```typescript
- sendMessage() ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫ GPT-4o-mini —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- createChatSession() ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π —á–∞—Ç–∞
- getChatSessions() ‚Üí –∏—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- validateMessage() ‚Üí –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
- generateChatTitle() ‚Üí –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —á–∞—Ç–∞
- getQuickQuestions() ‚Üí –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –±—ã—Å—Ç—Ä—ã–µ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤
```

### EmbeddingService (lib/services/embedding-service.ts)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** RAG —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π
**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
```typescript
- searchKnowledgeBase() ‚Üí —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
- addKnowledgeDocument() ‚Üí –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- getDocumentsByCategory() ‚Üí —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- getContextForAI() ‚Üí —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ò–ò
- Vector embeddings —á–µ—Ä–µ–∑ OpenAI text-embedding-ada-002
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase pgvector –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
```

### OpenAI API Integration
**API Routes:**
- `/api/chat` ‚Üí –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç —Å GPT-4o-mini + RAG
- `/api/search-knowledge` ‚Üí –ø–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π

**–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—ã (NEW v0.6.1):**
- **–¶–ü–ö (Navigator)** ‚Üí –æ—Å–Ω–æ–≤—ã –ø–∞—Ä—É—Å–Ω–æ–≥–æ —Å–ø–æ—Ä—Ç–∞, –Ω–∞–≤–∏–≥–∞—Ü–∏—è, –ø–æ–≥–æ–¥–∞, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
- **–®–∫–∏–ø–µ—Ä –ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä (Sailing Coach)** ‚Üí —Ç–µ—Ö–Ω–∏–∫–∞ –ø–∞—Ä—É—Å–Ω–æ–≥–æ —Å–ø–æ—Ä—Ç–∞ –∏ –æ–±—É—á–µ–Ω–∏–µ
- **–®–∫–∏–ø–µ—Ä –î–ê–û (DAO Advisor)** ‚Üí —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DAO –∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
- **–®–∫–∏–ø–µ—Ä –ü–∞—Ä—Ç–Ω–µ—Ä (AI Guide)** ‚Üí –ò–ò —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è [PREMIUM]
- **–®–∫–∏–ø–µ—Ä –ö–æ–º–ø–∞–Ω—å–æ–Ω (Personal)** ‚Üí –ª–∏—á–Ω–∞—è –ø–æ–º–æ—â—å –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è [AUTH REQUIRED]

### Mock Data (data/)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** Fallback –¥–∞–Ω–Ω—ã–µ (–±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —á–∞—Ç–µ)
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- `mock-profile.ts` ‚Üí fallback –ø—Ä–æ—Ñ–∏–ª–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

## üì° Data Flow & Integration Patterns

### 1. Theme Switching Flow
```
User Click ‚Üí toggleTheme() in AppContext ‚Üí
‚îú‚îÄ‚îÄ Update theme state ('light' | 'dark')
‚îú‚îÄ‚îÄ Apply to document.documentElement.classList
‚îú‚îÄ‚îÄ Save to localStorage
‚îî‚îÄ‚îÄ Re-render with new theme
```

### 2. Language Switching Flow
```
User Click ‚Üí toggleLanguage() in AppContext ‚Üí
‚îú‚îÄ‚îÄ Update language state ('en' | 'ru')
‚îú‚îÄ‚îÄ Save to localStorage
‚îú‚îÄ‚îÄ Re-render all components with new language
‚îî‚îÄ‚îÄ Update all UI text accordingly
```

### 3. Chat Message Flow (Mock)
```
User Input ‚Üí ChatBox.handleSend() ‚Üí
‚îú‚îÄ‚îÄ Check responsesLeft limit
‚îú‚îÄ‚îÄ Add user message to local state
‚îú‚îÄ‚îÄ Show typing indicator
‚îú‚îÄ‚îÄ Simulate AI response (setTimeout)
‚îú‚îÄ‚îÄ Add AI response to messages
‚îú‚îÄ‚îÄ decrementResponses() in context
‚îî‚îÄ‚îÄ Update UI state
```

### 4. Navigation Flow
```
User Click ‚Üí Next.js Link ‚Üí
‚îú‚îÄ‚îÄ App Router handles routing
‚îú‚îÄ‚îÄ Load appropriate page.tsx
‚îú‚îÄ‚îÄ Maintain layout from layout.tsx
‚îî‚îÄ‚îÄ Update URL and browser history
```

---

## üéØ Development Standards

### Code Organization
- **1 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç = 1 —Ñ–∞–π–ª**
- **–°–µ—Ä–≤–∏—Å—ã –≤ lib/** –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **TypeScript —Å—Ç—Ä–æ–≥–∏–π** - no any (–∫—Ä–æ–º–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π)
- **–ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ:** camelCase –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, PascalCase –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### Database Patterns  
- **UUID** –¥–ª—è –≤—Å–µ—Ö Primary Keys
- **JSONB** –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö
- **RLS** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫
- **–ú–∏–≥—Ä–∞—Ü–∏–∏** —á–µ—Ä–µ–∑ scripts —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### Error Handling
- **Try/catch** –≤ async —Ñ—É–Ω–∫—Ü–∏—è—Ö
- **User-friendly** —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- **–ö–æ–Ω—Å–æ–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- **Fallback —Å–æ—Å—Ç–æ—è–Ω–∏—è** –≤ UI

### Performance Optimizations  
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π polling** OpenAI API
- **Zustand selective subscriptions**
- **GIN –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è JSONB queries
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ re-renders** –≤ React

---

## üìã Current Implementation Status

### ‚úÖ –ì–æ—Ç–æ–≤–æ (v0.6.1 - Assistant System Redesign Complete)
**Phase 1: Basic Prototype**
- [x] Next.js 15 App Router —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- [x] Radix UI + Tailwind CSS –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞
- [x] –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å (ru/en) —á–µ—Ä–µ–∑ AppContext
- [x] –¢–µ–º–∏–∑–∞—Ü–∏—è (light/dark) —Å next-themes
- [x] Responsive –¥–∏–∑–∞–π–Ω –¥–ª—è mobile/desktop
- [x] Mock —á–∞—Ç —Å –ò–ò (–∏–º–∏—Ç–∞—Ü–∏—è –¥–∏–∞–ª–æ–≥–∞)
- [x] –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º —Ä–∞–∑–¥–µ–ª–∞–º
- [x] Soft gate –¥–ª—è –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**Phase 2: Authentication & Profiles**
- [x] Supabase –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- [x] –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (Email/Password)
- [x] –°—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –≤—Ö–æ–¥–∞
- [x] –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π —Å —Ä–æ–ª—è–º–∏ (–ò–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π—Å—è ‚Üí –ü–∞—Å—Å–∞–∂–∏—Ä ‚Üí –ú–∞—Ç—Ä–æ—Å)
- [x] –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
- [x] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å
- [x] –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Å–∞–π–¥–±–∞—Ä —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º
- [x] –¢–∞–±–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–æ—Ñ–∏–ª—è (–ü—Ä–æ—Ñ–∏–ª—å / –ú–æ–π –ü—É—Ç—å / –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è)

**Phase 3: Database & Services (–ó–∞–≤–µ—Ä—à–µ–Ω–∞)**
- [x] Supabase CLI –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- [x] –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (profiles, user_stats, user_achievements, user_chats)
- [x] RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [x] ProfileService –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
- [x] TypeScript —Ç–∏–ø—ã –¥–ª—è Supabase –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- [x] Supabase Storage –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ProfileService —Å AppContext
- [x] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞–º–∏ (AvatarUpload)
- [x] Real-time —Å–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ —Ä–æ–ª–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- [x] AchievementService —Å 12 –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è–º–∏
- [x] Seed –¥–∞–Ω–Ω—ã–µ –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**Phase 4: AI Integration & Advanced Features (–ó–∞–≤–µ—Ä—à–µ–Ω–∞)**
- [x] **OpenAI API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - GPT-4o-mini —Å –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —á–∞—Ç–∞
- [x] **RAG —Å–∏—Å—Ç–µ–º–∞** - Vector embeddings —Å Supabase pgvector
- [x] **–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π** - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–∞—Ä—É—Å–Ω–æ–º—É —Å–ø–æ—Ä—Ç—É
- [x] **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—ã** - –ù–∞–≤–∏–≥–∞—Ç–æ—Ä –∏ –®–∫–∏–ø–µ—Ä —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏
- [x] **–†–µ–∞–ª—å–Ω—ã–π —á–∞—Ç** - –ó–∞–º–µ–Ω–∞ mock –¥–∞–Ω–Ω—ã—Ö –Ω–∞ OpenAI API
- [x] **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã** - –ò–ò –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∞–∑—É –∑–Ω–∞–Ω–∏–π –¥–ª—è —Ç–æ—á–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- [x] **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π

**Phase 5: Guest Flow & Lead Generation (–ó–∞–≤–µ—Ä—à–µ–Ω–∞)**
- [x] **–î–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –≥–æ—Å—Ç–µ–≤–æ–π —Ñ–ª–æ—É** - 3 –≤–æ–ø—Ä–æ—Å–∞ ‚Üí email ‚Üí 3 –≤–æ–ø—Ä–æ—Å–∞ ‚Üí —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- [x] **Email Capture –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** - –ö—Ä–∞—Å–∏–≤–∞—è —Ñ–æ—Ä–º–∞ –¥–ª—è —Å–±–æ—Ä–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
- [x] **–£–º–Ω—ã–µ –ª–∏–º–∏—Ç—ã** - Soft limit (3 –≤–æ–ø—Ä–æ—Å–∞) –∏ hard limit (6 –≤–æ–ø—Ä–æ—Å–æ–≤)
- [x] **AppContext —Ä–∞—Å—à–∏—Ä–µ–Ω** - –ù–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –≥–æ—Å—Ç–µ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞ (guestStage, emailCaptured, totalQuestionsAsked)

**Phase 6: Navigation Context & Chat Search (–ó–∞–≤–µ—Ä—à–µ–Ω–∞ v0.6.0)**
- [x] **SQL –º–∏–≥—Ä–∞—Ü–∏–∏** - –¢–∞–±–ª–∏—Ü—ã navigation_history, chat_sessions, chat_search_index
- [x] **Navigation History** - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —É–º–Ω–æ–π –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
- [x] **Full-text Search** - –ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É —á–∞—Ç–æ–≤ —Å PostgreSQL FTS (—Ä—É—Å—Å–∫–∏–π + –∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
- [x] **AssistantDock** - –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ø–ª–∞–≤–∞—é—â–∞—è –ø–∞–Ω–µ–ª—å —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞–º
- [x] **Smart Back Button** - –¢–æ—á–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ –∏—Å—Ö–æ–¥–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–∑ —á–∞—Ç–∞
- [x] **Mobile UX** - Dock —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ, —ç–∫—Å–ø–∞–Ω–¥–∏—Ç—Å—è –ø–æ —Ç–∞–ø—É
- [x] **Supabase Functions** - search_user_chats(), get_user_navigation_context()
- [x] **AppContext Navigation** - –ú–µ—Ç–æ–¥—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- [x] **ChatBox –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∫–∞–∑ —Ñ–æ—Ä–º –≤ –Ω—É–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç
- [x] **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã** - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —ç–º–æ–¥–∂–∏ –¥–æ 1 –Ω–∞ –æ—Ç–≤–µ—Ç
- [x] **Lead generation –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å** - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è email –≤ Supabase
- [ ] **–¢–∞–±–ª–∏—Ü–∞ email_leads** - –°–æ–∑–¥–∞–Ω–∏–µ –≤ Supabase –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–∏–¥–æ–≤
- [ ] **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ–æ—Ä–º—ã –¥–ª—è —ç—Ç–∞–ø–∞ 2

**Phase 6.1: Assistant System Redesign (–ó–∞–≤–µ—Ä—à–µ–Ω–∞ v0.6.1)**
- [x] **–ù–æ–≤–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤** - 6 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å —Ä—É—Å—Å–∫–∏–º–∏/–∞–Ω–≥–ª–∏–π—Å–∫–∏–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏
- [x] **AssistantSelector –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** - –ö—Ä–∞—Å–∏–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞–º–∏ –∏ –∏–∫–æ–Ω–∫–∞–º–∏
- [x] **–†–æ–ª—å-–±–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø** - –ü—Ä–µ–º–∏—É–º –∏ –∞–≤—Ç–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—ã
- [x] **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —á–∞—Ç–æ–º** - –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –±–µ–π–¥–∂–∏/–∞–≤–∞—Ç–∞—Ä—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤ –≤ ChatBox
- [x] **URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä—è–º—ã—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤ (/chat?assistant=sailing_coach)
- [x] **–í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã** - Locked/unlocked —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

**Phase 7.0: Content Pages & Community Links (–ó–∞–≤–µ—Ä—à–µ–Ω–∞ v0.7.0)**
- [x] **React hooks –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –æ—à–∏–±–∫–∞ –ø–æ—Ä—è–¥–∫–∞ —Ö—É–∫–æ–≤ –≤ LeftSidebar
- [x] **–°—Ç—Ä–∞–Ω–∏—Ü–∞ "–ù–∞—à–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞"** - /communities —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ –≤–Ω–µ—à–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
- [x] **CommunityCard –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å tooltip –∏ external links
- [x] **–†–∞–∑–¥–µ–ª "–û –∫–ª—É–±–µ"** - –ù–æ–≤–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –≥—Ä—É–ø–ø–∞ –º–µ–∂–¥—É Chat –∏ Yachting
- [x] **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ–Ω—Ü–µ–ø—Ü–∏–π** - /about/concepts —Å 7 –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ –∫–ª—é—á–µ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [x] **ConceptCard –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** - –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å —Ü–≤–µ—Ç–æ–≤–æ–π –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏–µ–π
- [x] **Tooltip –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –ü–æ–ª–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –∫—É—Ä—Å–æ—Ä–∞
- [x] **Accessibility —É–ª—É—á—à–µ–Ω–∏—è** - Keyboard navigation –∏ screen reader support

**Phase 7.1: File Upload System (–ó–∞–≤–µ—Ä—à–µ–Ω–∞)**
- [x] **File upload infrastructure** - –ë–∞–∑–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- [x] **Supabase Storage integration** - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É —Ñ–∞–π–ª–æ–≤
- [x] **Chat file attachments** - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å —Ñ–∞–π–ª—ã –∫ —Å–æ–æ–±—â–µ–Ω–∏—è–º
- [x] **Error handling** - Graceful fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ storage

**Phase 7.2: Architecture Analysis & Code Quality (–ó–∞–≤–µ—Ä—à–µ–Ω–∞)**
- [x] **Architectural review** - –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ —Å recommendations
- [x] **Security improvements** - ENV validation, secure CORS headers, .env.example
- [x] **Code quality tools** - TypeScript ES2015, npm scripts (typecheck, audit, analyze)
- [x] **Migration consolidation** - Unified supabase/migrations/ structure
- [x] **Type system cleanup** - AssistantType enum standardization
- [x] **Documentation upgrade** - Professional README.md, REVIEW.md production checklist
- [x] **Dependency updates** - Security audit (0 vulnerabilities), caniuse-lite update
- [x] **Development infrastructure** - Analysis tools (depcheck, ts-prune)

### üìã –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è (Phase 8: Social & Advanced Features)
- [ ] –°–∏—Å—Ç–µ–º–∞ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–æ–≤ –∏ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
- [ ] –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–¥—Ä—É–∑—å—è, –≥—Ä—É–ø–ø—ã)
- [ ] DAO —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–ª–æ–∫—á–µ–π–Ω–æ–º
- [ ] –°–∏—Å—Ç–µ–º–∞ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–π
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–∞—Ä—É—Å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ –∫–∞—Ä—Ç–∞–º–∏
- [ ] API –¥–ª—è —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- [ ] PWA —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

## üîÑ Evolution & Migration Strategy

### –ü–æ–¥—Ö–æ–¥ –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º
1. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ** –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ
2. **Database changes** ‚Üí DATABASE_CHANGELOG.md
3. **Backward compatibility** –∫–æ–≥–¥–∞ –≤–æ–∑–º–æ–∂–Ω–æ
4. **Feature flags** –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### Migration Pattern
```
Planning ‚Üí Implementation ‚Üí Testing ‚Üí Documentation ‚Üí Deployment
    ‚Üì           ‚Üì              ‚Üì           ‚Üì            ‚Üì
  This file  Code+Tests    Manual QA   Update docs   Git push
```

---

## üóÑÔ∏è Database Schema Overview

### Supabase Tables Structure
```sql
-- –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
profiles (id, full_name, nickname, avatar_url, city, bio, role, join_date, timestamps)

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
user_stats (id, questions_asked, lessons_completed, articles_read, community_messages, last_login_date, total_logins, timestamps)

-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
user_achievements (id, user_id, achievement_id, title, title_ru, description, description_ru, icon_name, category, unlocked_at, timestamps)

-- –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤
user_chats (id, user_id, title, assistant_type, main_topic, messages_count, last_activity, timestamps)

-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (NEW v0.6.0!)
navigation_history (
  id, user_id, previous_url, previous_title, current_url,
  section, content_type, content_id, scroll_position,
  viewport_width, viewport_height, user_agent, session_id, timestamps
)

-- –°–µ—Å—Å–∏–∏ —á–∞—Ç–æ–≤ (NEW v0.6.0!)
chat_sessions (
  id, user_id, title, assistant_type, timestamps
)

-- –ü–æ–∏—Å–∫–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å —á–∞—Ç–æ–≤ (NEW v0.6.0!)
chat_search_index (
  id, user_id, chat_session_id, message_id, message_content,
  message_role, assistant_type, chat_title,
  search_vector tsvector, timestamps
)
```

### Vector Search System
- **pgvector extension** –≤–∫–ª—é—á–µ–Ω –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **Embeddings model** OpenAI text-embedding-ada-002 (1536 dimensions)
- **Languages** –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ru/en –∫–æ–Ω—Ç–µ–Ω—Ç–∞

### Navigation & Chat Search Functions (NEW v0.6.0)
- **search_user_chats()** –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ —á–∞—Ç–∞–º —Å —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **get_user_navigation_context()** –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- **Full-text search** PostgreSQL FTS —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä—É—Å—Å–∫–æ–≥–æ –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è** —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞ –≤ search_vector
- **RLS policies** —Å—Ç—Ä–æ–≥–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫

### Storage Buckets
- **avatars** - –ê–≤–∞—Ç–∞—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏

### Real-time Features
- Live –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

---

---

## üéâ Phase 4.1 Completion Summary

**–§–∞–∑–∞ 4.1: AI Integration** —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (2025-09-15)

### ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:
1. **ü§ñ OpenAI API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - GPT-4o-mini —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —á–∞—Ç–∞
2. **üß† RAG —Å–∏—Å—Ç–µ–º–∞** - Vector embeddings + Supabase pgvector –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
3. **üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π** - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –ø–∞—Ä—É—Å–Ω–æ–º—É —Å–ø–æ—Ä—Ç—É
4. **‚öì –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—ã** - –ù–∞–≤–∏–≥–∞—Ç–æ—Ä –∏ –®–∫–∏–ø–µ—Ä —Å —Ä–∞–∑–Ω–æ–π —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–æ–π
5. **üí¨ –†–µ–∞–ª—å–Ω—ã–π —á–∞—Ç** - –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ mock –¥–∞–Ω–Ω—ã—Ö –Ω–∞ OpenAI API
6. **üìä Smart —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —á–∞—Ç–∞

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:
- **ChatService** - –ü–æ–ª–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å OpenAI API
- **EmbeddingService** - RAG —Å–∏—Å—Ç–µ–º–∞ —Å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º –ø–æ–∏—Å–∫–æ–º
- **API Routes** - `/api/chat` –∏ `/api/search-knowledge` –¥–ª—è backend –ª–æ–≥–∏–∫–∏
- **Vector Database** - pgvector extension —Å optimized –ø–æ–∏—Å–∫–æ–º
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã** - –ò–ò –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- **–í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –≤–≤–æ–¥–∞
- **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π UI** - –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤

### üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:
- **–ù–∞—Å—Ç–æ—è—â–∏–µ –æ—Ç–≤–µ—Ç—ã** –æ—Ç GPT-4o-mini –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –ø–∞—Ä—É—Å–Ω–æ–º—É —Å–ø–æ—Ä—Ç—É
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –æ—Å–≤–µ–¥–æ–º–ª–µ–Ω–Ω–æ—Å—Ç—å** - –ò–ò –∑–Ω–∞–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –ø–∞—Ä—É—Å–Ω–æ–≥–æ —Å–ø–æ—Ä—Ç–∞ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- **–î–≤–∞ —Ç–∏–ø–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤** - –ù–∞–≤–∏–≥–∞—Ç–æ—Ä –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤, –®–∫–∏–ø–µ—Ä –¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö
- **–°–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤** - –ì–æ—Å—Ç–∏ –ø–æ–ª—É—á–∞—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∑–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ —á–∞—Ç–µ

### üìä –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ Phase 4.2:
- Streaming responses –¥–ª—è –ª—É—á—à–µ–≥–æ UX
- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Ç–æ–≤ –≤ Supabase
- File upload —Å–∏—Å—Ç–µ–º–∞
- Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π

---

## üîß Phase 4.1.1 Bug Fix Summary (2025-09-16)

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥ —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω:**

### üêõ –ü—Ä–æ–±–ª–µ–º–∞:
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞ (–æ—à–∏–±–∫–∞ "Database error saving new user")
- 500 –æ—à–∏–±–∫–∞ –æ—Ç Supabase auth/signup endpoint
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π –ë–î –∏ –Ω–∞—à–µ–π –ª–æ–≥–∏–∫–æ–π —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π

### ‚úÖ –†–µ—à–µ–Ω–∏–µ:
1. **–£–¥–∞–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è** `create_profile_for_user` –∏–∑ –ë–î
2. **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è** `createInitialProfile` –≤ app-context.tsx
3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç** TrendingUp –∏–∫–æ–Ω–∫–∏ –≤ achievements-tab.tsx
4. **–£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –æ—à–∏–±–æ–∫ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- **lib/contexts/app-context.tsx**: –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è createInitialProfile —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º –∑–∞–ø–∏—Å–µ–π –≤ Supabase
- **components/profile/achievements-tab.tsx**: –¥–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç TrendingUp
- **Database**: —É–¥–∞–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è create_profile_for_user
- **lib/supabase/profile-service.ts**: —É–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

### üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ /signup —Å—Ç—Ä–∞–Ω–∏—Ü—É
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ Supabase Dashboard —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –í–∫–ª–∞–¥–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ Phase 4.2 —Ä–∞–∑–≤–∏—Ç–∏—é

## üéØ Phase 5.0 Guest Flow Implementation Summary (2025-01-17)

**–î–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –≥–æ—Å—Ç–µ–≤–æ–π —Ä–µ–∂–∏–º —Å email capture —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω:**

### üöÄ –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- **–£–º–Ω—ã–π –ª–∏–º–∏—Ç –≤–æ–ø—Ä–æ—Å–æ–≤**: 3 –≤–æ–ø—Ä–æ—Å–∞ ‚Üí email ‚Üí 3 –≤–æ–ø—Ä–æ—Å–∞ ‚Üí —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- **Email Capture —Ñ–æ—Ä–º–∞**: –ö—Ä–∞—Å–∏–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Å–±–æ—Ä–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –Ω–∞ —ç—Ç–∞–ø–µ 1
- **Registration Prompt**: –ú–æ—Ç–∏–≤–∏—Ä—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —ç—Ç–∞–ø–µ 2
- **UX –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –ú—è–≥–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏ –±–µ–∑ —Ä–µ–∑–∫–∏—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

#### **lib/contexts/app-context.tsx**:
- –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è: `guestStage`, `emailCaptured`, `totalQuestionsAsked`
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `captureEmail()` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–∏–¥–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ `decrementResponses()` –¥–ª—è –¥–≤—É—Ö—ç—Ç–∞–ø–Ω–æ–≥–æ —Ñ–ª–æ—É
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü—É `email_leads`

#### **components/ui/email-capture.tsx** (–Ω–æ–≤—ã–π —Ñ–∞–π–ª):
- Responsive —Ñ–æ—Ä–º–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π email
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç–∏ (ru/en)
- –°–æ—Å—Ç–æ—è–Ω–∏—è loading –∏ success
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–∑–∂–µ" –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ —ç—Ç–∞–ø–∞
- –ö—Ä–∞—Å–∏–≤—ã–π –¥–∏–∑–∞–π–Ω —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞–º–∏ –∏ –∏–∫–æ–Ω–∫–∞–º–∏

#### **components/ui/chat-box.tsx**:
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è EmailCapture –ø–æ—Å–ª–µ 3-–≥–æ –≤–æ–ø—Ä–æ—Å–∞
- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ—Å–ª–µ 6-–≥–æ –≤–æ–ø—Ä–æ—Å–∞
- –£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –Ω–∞ –æ—Å–Ω–æ–≤–µ `guestStage`
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç

#### **next.config.js**:
- –£–±—Ä–∞–Ω `output: 'export'` –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å API routes
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏

### üìä UX Flow:
1. **–≠—Ç–∞–ø 1** (–≤–æ–ø—Ä–æ—Å—ã 1-3): –°–≤–æ–±–æ–¥–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ —Å –ò–ò
2. **Email Capture**: "–í–∏–∂—É, –≤–∞—Å –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–ª –Ω–∞—à –∫–ª—É–±! –û—Å—Ç–∞–≤—å—Ç–µ email..."
3. **–≠—Ç–∞–ø 2** (–≤–æ–ø—Ä–æ—Å—ã 4-6): –ï—â–µ 3 –≤–æ–ø—Ä–æ—Å–∞ –ø–æ—Å–ª–µ email / –∫–Ω–æ–ø–∫–∏ "–ü–æ–∑–∂–µ"
4. **Registration**: "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è —Å–ø–∞–º–∞..."

### üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ì–æ—Å—Ç–µ–≤–æ–π —Ñ–ª–æ—É —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- ‚úÖ Email capture –≥–æ—Ç–æ–≤ –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—é –≤ Supabase
- ‚úÖ –ú—è–≥–∫–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è –∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ UX –∫–∞—á–µ—Å—Ç–≤–∞ –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö
- üîÑ –ì–æ—Ç–æ–≤–æ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Supabase email_leads —Ç–∞–±–ª–∏—Ü–µ–π

### üìã –û—Å—Ç–∞–ª–æ—Å—å –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å:
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `email_leads` –≤ Supabase
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã –ò–ò (–ª–∏–º–∏—Ç 1 —ç–º–æ–¥–∂–∏)
- [ ] –£–ª—É—á—à–∏—Ç—å CSS –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

---

## üöÄ Claude 4.5 Architecture Recommendations

### 1. Next.js App Router Optimization

**–¢–µ–∫—É—â–∞—è –æ—Ü–µ–Ω–∫–∞:**
- ‚úÖ –•–æ—Ä–æ—à–æ: App Router —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å route groups
- ‚úÖ –•–æ—Ä–æ—à–æ: Server/Client Components —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
- ‚ö†Ô∏è –£–ª—É—á—à–∏—Ç—å: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å Server Components
- ‚ö†Ô∏è –£–ª—É—á—à–∏—Ç—å: Code splitting –¥–ª—è route groups

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
```typescript
// –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ Client Components:
// - components/ui/chat-box.tsx (useState, useEffect)
// - components/ui/email-capture.tsx (forms, state)
// - components/layout/mobile-drawer.tsx (interactions)

// ‚ö†Ô∏è –ú–æ–≥—É—Ç –±—ã—Ç—å Server Components:
// - components/ui/hero-card.tsx (—Å—Ç–∞—Ç–∏—á–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç)
// - components/ui/community-card.tsx (–µ—Å–ª–∏ –Ω–µ—Ç onClick)
// - components/profile/achievements-tab.tsx (–µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ props)

// üéØ Code Splitting Pattern:
// app/(main)/chat/page.tsx
export default async function ChatPage() {
  // Server Component –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
  return (
    <Suspense fallback={<ChatSkeleton />}>
      <ChatBoxClient /> {/* Dynamic import */}
    </Suspense>
  );
}
```

### 2. React Context Performance

**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
- AppContext —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (theme, language, auth, guest flow)
- –õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—ã–∑—ã–≤–∞–µ—Ç re-render –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
```typescript
// –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã:

// 1. ThemeContext (—Ä–µ–¥–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
interface ThemeContextType {
  theme: 'light' | 'dark';
  toggleTheme: () => void;
}

// 2. LocaleContext (—Ä–µ–¥–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
interface LocaleContextType {
  language: 'en' | 'ru';
  toggleLanguage: () => void;
}

// 3. AuthContext (—Å—Ä–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
interface AuthContextType {
  user: User | null;
  isAuthenticated: boolean;
  login: (credentials) => Promise<void>;
  logout: () => Promise<void>;
}

// 4. GuestFlowContext (—á–∞—Å—Ç—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
interface GuestFlowContextType {
  responsesLeft: number;
  guestStage: number;
  emailCaptured: string | null;
  totalQuestionsAsked: number;
  decrementResponses: () => void;
  captureEmail: (email: string) => Promise<void>;
}

// –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
// - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
// - –ú–µ–Ω—å—à–µ re-renders
// - –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
```

### 3. Component Memoization Strategy

**–ê–Ω–∞–ª–∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**
```typescript
// üéØ –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è memo:

// ChatBox - –º–Ω–æ–≥–æ state, —á–∞—Å—Ç—ã–µ updates
export const ChatBox = React.memo(({
  assistantType,
  onBack
}: ChatBoxProps) => {
  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å useCallback –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π
  const handleSend = useCallback((message: string) => {
    // logic
  }, [assistantType]);

  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å useMemo –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
  const filteredMessages = useMemo(
    () => messages.filter(m => m.agent === assistantType),
    [messages, assistantType]
  );

  return <div>...</div>;
});

// AssistantDock - scroll events
export const AssistantDock = React.memo(() => {
  const handleScroll = useMemo(
    () => debounce(() => {
      // scroll logic
    }, 100),
    []
  );

  return <div>...</div>;
});

// ProfileInfoTab - real-time updates
export const ProfileInfoTab = React.memo(({ profile }: Props) => {
  // Selective context subscription
  const updateProfile = useAppContext(ctx => ctx.updateProfile);

  return <div>...</div>;
});
```

### 4. Database Query Optimization

**–¢–µ–∫—É—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã:**
```typescript
// ‚ö†Ô∏è –ú–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å:
const { data } = await supabase
  .from('profiles')
  .select('*'); // –≤—ã–±–∏—Ä–∞–µ–º –≤—Å—ë

// ‚úÖ –õ—É—á—à–µ (—Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è):
const { data } = await supabase
  .from('profiles')
  .select(`
    id,
    full_name,
    nickname,
    avatar_url,
    role,
    user_stats(questions_asked, lessons_completed)
  `)
  .eq('id', userId)
  .single();
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è FAQ Agent:**
```typescript
// –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è match_docs:
create or replace function match_docs(
  query_embedding vector(1536),
  match_count int default 5,
  user_roles text[] default array['–≥–æ—Å—Ç—å']::text[],
  min_similarity float default 0.7 -- –¥–æ–±–∞–≤–∏—Ç—å threshold
) returns table (
  id uuid,
  text text,
  similarity float,
  url text
)
language sql stable
as $$
  select
    id,
    text,
    1 - (embedding <=> query_embedding) as similarity,
    url
  from knowledge_chunks
  where
    accessible_roles && user_roles
    and 1 - (embedding <=> query_embedding) > min_similarity -- —Ñ–∏–ª—å—Ç—Ä –¥–æ sort
  order by embedding <=> query_embedding
  limit match_count;
$$;

// –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å –¥–ª—è —Ä–æ–ª–µ–π:
create index if not exists idx_knowledge_chunks_roles
on knowledge_chunks using gin(accessible_roles);
```

### 5. RAG System Enhancements

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (v0.8.1):**
- ‚úÖ Vector search —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Citations –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- ‚ö†Ô∏è –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è embeddings
- ‚ö†Ô∏è –ù–µ—Ç reranking —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
```typescript
// 1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ embeddings –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤:
interface EmbeddingsCache {
  [questionHash: string]: {
    embedding: number[];
    timestamp: number;
    hits: number;
  };
}

// 2. Reranking –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏:
async function rerankResults(
  results: SearchResult[],
  userQuery: string
): Promise<SearchResult[]> {
  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å cross-encoder –º–æ–¥–µ–ª—å –¥–ª—è reranking
  // –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ–π BM25 scoring –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
  return results.sort((a, b) => {
    const scoreA = calculateRelevance(a.text, userQuery);
    const scoreB = calculateRelevance(b.text, userQuery);
    return scoreB - scoreA;
  });
}

// 3. Adaptive threshold –ø–æ —Ä–æ–ª—è–º:
const similarityThresholds = {
  '–≥–æ—Å—Ç—å': 0.75,      // —Å—Ç—Ä–æ–∂–µ –¥–ª—è –≥–æ—Å—Ç–µ–π
  '–ø–∞—Å—Å–∞–∂–∏—Ä': 0.70,   // —Å—Ä–µ–¥–Ω–µ
  '–º–∞—Ç—Ä–æ—Å': 0.65,     // –±–æ–ª–µ–µ —Å–≤–æ–±–æ–¥–Ω–æ
};
```

### 6. OpenAI API Optimizations

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ –•–æ—Ä–æ—à–æ: GPT-4o-mini –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏
- ‚ö†Ô∏è –£–ª—É—á—à–∏—Ç—å: –Ω–µ—Ç streaming
- ‚ö†Ô∏è –£–ª—É—á—à–∏—Ç—å: –Ω–µ—Ç error retry logic

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
```typescript
// 1. Streaming –¥–ª—è –ª—É—á—à–µ–≥–æ UX:
export async function streamChatResponse(
  messages: ChatMessage[],
  onChunk: (text: string) => void
) {
  const stream = await openai.chat.completions.create({
    model: 'gpt-4o-mini',
    messages,
    stream: true,
  });

  for await (const chunk of stream) {
    const content = chunk.choices[0]?.delta?.content;
    if (content) {
      onChunk(content);
    }
  }
}

// 2. Exponential backoff retry:
async function callOpenAIWithRetry(
  fn: () => Promise<any>,
  maxRetries = 3
): Promise<any> {
  let attempt = 0;
  while (attempt < maxRetries) {
    try {
      return await fn();
    } catch (error) {
      attempt++;
      if (attempt >= maxRetries) throw error;

      const delay = Math.min(1000 * Math.pow(2, attempt), 10000);
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
}

// 3. Prompt caching (–Ω–æ–≤–∞—è —Ñ–∏—á–∞ OpenAI):
const response = await openai.chat.completions.create({
  model: 'gpt-4o-mini',
  messages: [
    {
      role: 'system',
      content: systemPrompt,
      // –ü–æ–º–µ—Ç–∏—Ç—å –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:
      cache_control: { type: 'ephemeral' }
    },
    ...userMessages
  ],
});
```

### 7. Type Safety Improvements

**–¢–µ–∫—É—â–∞—è –æ—Ü–µ–Ω–∫–∞:**
- ‚úÖ –•–æ—Ä–æ—à–æ: AssistantType enum
- ‚úÖ –•–æ—Ä–æ—à–æ: Supabase types –≤ lib/supabase/types.ts
- ‚ö†Ô∏è –£–ª—É—á—à–∏—Ç—å: Type guards –¥–ª—è runtime –ø—Ä–æ–≤–µ—Ä–æ–∫
- ‚ö†Ô∏è –£–ª—É—á—à–∏—Ç—å: Discriminated unions –¥–ª—è messages

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
```typescript
// 1. Type guards –¥–ª—è FAQ messages:
interface BaseChatMessage {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  timestamp: Date;
}

interface FAQMessage extends BaseChatMessage {
  agent: 'faq';
  citations: Citation[];
  trace?: {
    context_chunks: number;
    similarity_avg: number;
  };
}

interface RegularMessage extends BaseChatMessage {
  agent: Exclude<AssistantType, 'faq'>;
  citations?: never;
}

type ChatMessage = FAQMessage | RegularMessage;

// Type guard:
function isFAQMessage(msg: ChatMessage): msg is FAQMessage {
  return msg.agent === 'faq' && 'citations' in msg;
}

// 2. –°—Ç—Ä–æ–≥–∏–µ —Ç–∏–ø—ã –¥–ª—è Supabase:
type ProfileRow = Database['public']['Tables']['profiles']['Row'];
type ProfileInsert = Database['public']['Tables']['profiles']['Insert'];
type ProfileUpdate = Database['public']['Tables']['profiles']['Update'];

// 3. Zod validation –¥–ª—è API:
import { z } from 'zod';

const FAQRequestSchema = z.object({
  session_id: z.string().uuid(),
  user_message: z.string().min(1).max(500),
  user_role: z.enum(['–≥–æ—Å—Ç—å', '–ø–∞—Å—Å–∞–∂–∏—Ä', '–º–∞—Ç—Ä–æ—Å']),
  prefs: z.object({
    lang: z.enum(['ru', 'en']),
  }),
});

export type FAQRequest = z.infer<typeof FAQRequestSchema>;
```

### 8. Security & RLS Enhancements

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
- API key –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ Edge Functions
- Input validation –¥–ª—è user messages
- Rate limiting –¥–ª—è guest users

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RLS –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü:

-- knowledge_chunks (public read, admin write)
create policy "Public can read knowledge chunks"
on knowledge_chunks for select
using (true);

create policy "Only admins can modify knowledge chunks"
on knowledge_chunks for all
using (auth.jwt() ->> 'role' = 'admin');

-- chat_messages (users own messages)
create policy "Users can access own chat messages"
on chat_messages for all
using (
  session_id in (
    select id from chat_sessions
    where user_id = auth.uid()
  )
);

-- Rate limiting –¥–ª—è email_leads:
create or replace function check_email_rate_limit(
  email text
) returns boolean
language plpgsql security definer
as $$
declare
  recent_count int;
begin
  select count(*) into recent_count
  from email_leads
  where email = check_email_rate_limit.email
    and created_at > now() - interval '1 hour';

  return recent_count < 3; -- max 3 submissions per hour
end;
$$;
```

### 9. Performance Monitoring

**–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏:**
```typescript
// 1. Supabase query timing:
const startTime = Date.now();
const { data, error } = await supabase
  .from('profiles')
  .select('*');
const queryTime = Date.now() - startTime;

if (queryTime > 1000) {
  console.warn(`Slow query: profiles SELECT took ${queryTime}ms`);
}

// 2. OpenAI API latency:
const metrics = {
  embedding_time: 0,
  search_time: 0,
  llm_time: 0,
  total_time: 0,
};

// 3. Component render tracking:
if (process.env.NODE_ENV === 'development') {
  const renderStart = performance.now();
  // component render
  const renderTime = performance.now() - renderStart;
  if (renderTime > 16) { // > 1 frame
    console.warn(`Slow render: ${componentName} took ${renderTime}ms`);
  }
}
```

---

## üéØ Priority Roadmap with Claude 4.5

### Quick Wins (–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∑–∞ 1-2 –¥–Ω—è):
1. ‚úÖ **React.memo –¥–ª—è ChatBox** - —É–º–µ–Ω—å—à–∏—Ç—å re-renders
2. ‚úÖ **Type guards –¥–ª—è FAQ** - –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å citations
3. ‚úÖ **Supabase query optimization** - select —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è
4. ‚úÖ **Min similarity threshold** - –¥–ª—è match_docs —Ñ—É–Ω–∫—Ü–∏–∏

### Medium Priority (—Å–ª–µ–¥—É—é—â–∏–µ 1-2 —Å–ø—Ä–∏–Ω—Ç–∞):
1. üéØ **Context splitting** - —Ä–∞–∑–¥–µ–ª–∏—Ç—å AppContext –Ω–∞ 4 –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
2. üéØ **Streaming responses** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–ª—è chat API
3. üéØ **Embeddings cache** - –∫—ç—à –¥–ª—è —á–∞—Å—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
4. üéØ **Error retry logic** - exponential backoff –¥–ª—è OpenAI
5. üéØ **RLS audit** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### Long Term (–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ Phase 9+):
1. üìã **Multi-agent orchestration** - –º–µ—Ç–∞-–∞–≥–µ–Ω—Ç —Å –ø–æ–¥-–∞–≥–µ–Ω—Ç–∞–º–∏
2. üìã **Advanced RAG** - reranking –∏ hybrid search
3. üìã **Performance monitoring** - dashboard —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
4. üìã **Code splitting** - lazy loading –¥–ª—è route groups
5. üìã **Redis cache** - –¥–ª—è production deployment

---

*–î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏*
*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-01-24 (Phase 7.2 Architecture Analysis Complete)*